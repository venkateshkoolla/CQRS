CREATE VIEW [dbo].[view_Contacts]
    AS
SELECT [Contact].[ContactId] AS [Id]
    , [Contact].[FirstName]
    , [Contact].[MiddleName]
    , [Contact].[LastName]
    , [Contact].[OCASLR_PreviousLastName] AS [PreviousLastName]
    , [Contact].[EMailAddress1] AS [Email]
    , [Contact].[OCASLR_UserName] AS [Username]
    , [Contact].[ocaslr_userid] AS [SubjectId]
    , [Contact].[BirthDate]
    , [Contact].[OCASLR_ContactType] AS [ContactType]
    , [Contact].[ocaslr_accountstatusid] AS [AccountStatusId]
    , [Contact].[ocaslr_acceptedprivacystatementid] AS [AcceptedPrivacyStatementId]
    , [Contact].[ocaslr_Source] AS [SourceId]
    , [Contact].[OCASLR_AccountNumber] AS [AccountNumber]
    , [Contact].[ocaslr_preferredlanguageid] AS [PreferredLanguageId]
    , [Contact].[OCASLR_PreferredName] AS [PreferredName]
    , [Contact].[DoNotSendMM] AS [DoNotSendMM]
    , [Contact].[LastUsedInCampaign] AS [LastUsedInCampaign]
    , [Contact].[ocaslr_gendercodeid] AS [GenderId]
    , [Contact].[ocaslr_firstgenerationapplicantid] AS [FirstGenerationId]
    , [Contact].[ocaslr_firstlanguageid] AS [FirstLanguageId]
    , [Contact].[ocaslr_titleid] AS [TitleId]
    , [Contact].[ocaslr_preferredcorrespondencemethodid] AS [PreferredCorrespondenceMethodId]
    , [Contact].[Telephone2] AS [HomePhone]
    , [Contact].[MobilePhone] AS [MobilePhone]
    , [Contact].[ocaslr_countryofbirthid] AS [CountryOfBirthId]
    , [Contact].[ocaslr_countryofcitizenshipid] AS [CountryOfCitizenshipId]
    , [Contact].[OCASLR_DateOfArrival] AS [DateOfArrival]
    , [Contact].[ocaslr_IsAboriginalPerson] AS [IsAboriginalPerson]
    , [Contact].[ocaslr_aboriginalstatusid] AS [AboriginalStatusId]
    , [Contact].[ocaslr_otheraboriginalstatus] AS [OtherAboriginalStatus]
    , [Contact].[ocaslr_statusincanadaid] AS [StatusInCanadaId]
    , [Contact].[ocaslr_statusofvisaid] AS [StatusOfVisaId]
    , [Contact].[ocaslr_preferredsponsoragencyid] AS [SponsorAgencyId]
    , [Contact].[ocaslr_highschoolenrolled] AS [HighSchoolEnrolled]
    , [Contact].[ocaslr_highschoolgraduated] AS [HighSchoolGraduated]
    , [Contact].[ocaslr_highschoolgraduationdate] AS [HighSchoolGraduationDate]
    , [Contact].[OCASLR_OntarioEducationNumber] AS [OntarioEducationNumber]
    , [Contact].[Ocaslr_ontarioeducationnumberlock] AS [OntarioEducationNumberLock]
    , [Contact].[OCASLR_OverPayment] AS [OverPayment]
    , [Contact].[OCASLR_Balance] AS [Balance]
    , [Contact].[OCASLR_nsfbalance] AS [NsfBalance]
    , [Contact].[OCASLR_ReturnedPayment] AS [ReturnedPayment]
    , [Contact].[Ocaslr_PaymentLocked] AS [PaymentLocked]
    , [Contact].[OCASLR_LastLogin] AS [LastLogin]
    , [Contact].[OCASLR_isexceedlastloginperiod] AS [LastLoginExceed]
    , [Contact].[ocaslr_sourcepartnerid] AS [SourcePartnerId]
    , [IntlAssessment].[ocaslr_coursesecondaryevaluatorid] AS [IntlEvaluatorId]
    , [IntlAssessment].[ocaslr_referencenumber] AS [IntlReferenceNumber]
    , [Contact].[CreatedOn]
    , [Contact].[ModifiedOn]
    -- following fields are mapped to Contact.MailingAddress 
    , [Country].[ocaslr_countryId] AS [CountryId]
    , [Country].[ocaslr_name] AS [Country]
    , [ProvinceState].[ocaslr_provincestateId] AS [ProvinceStateId]
    , [Address].[StateOrProvince] AS [ProvinceState]
    , [Address].[City] AS [City]
    -- From CBA: https://ocas.visualstudio.com/OCAS%20Portfolio/_git/domesticapi?path=%2Fsrc%2FOCAS.Core.API%2FPlugin.CRM%2FRepository%2FCrmApplicantContactRepository.cs&version=GBmaster&line=264&lineStyle=plain&lineEnd=264&lineStartColumn=13&lineEndColumn=87
    , CASE WHEN [Address].[Line2] IS NULL AND [Address].[Line1] IS NOT NULL THEN
        [Address].[Line1]
      ELSE
        [Address].[Line2]
      END AS [Street]
    , [Address].[PostalCode] AS [PostalCode]
    , [Contact].[OCASLR_ValidatedAddress] AS [Verified]
    , [Contact].[StateCode]
    , [Contact].[StatusCode]
FROM [$(SERVER)].[OCAS_MSCRM].[dbo].[ContactBase] [Contact]
    LEFT OUTER JOIN [$(SERVER)].[OCAS_MSCRM].[dbo].[CustomerAddressBase] AS [Address]
        ON ([Contact].[ContactId] = [Address].ParentId AND [Address].AddressNumber = 1)
    LEFT OUTER JOIN [$(SERVER)].[OCAS_MSCRM].[dbo].[ocaslr_countryBase] [Country]
        ON [Address].[Country] = [Country].[ocaslr_name]
    LEFT OUTER JOIN [$(SERVER)].[OCAS_MSCRM].[dbo].[ocaslr_provincestateBase] [ProvinceState]
        ON [Address].[StateOrProvince] = [ProvinceState].[ocaslr_code]
    LEFT OUTER JOIN [$(SERVER)].[OCAS_MSCRM].[dbo].[ocaslr_internationalcreditassessmentBase] [IntlAssessment]
        ON [Contact].[ContactId] = [IntlAssessment].[ocaslr_applicantid]
