CREATE VIEW [dbo].[view_FinancialTransactions]
    AS
SELECT [FinancialTransaction].[ocaslr_financialtransactionId] AS [Id]
     , [FinancialTransaction].[ocaslr_name] AS [Name]
     , [FinancialTransaction].[CreatedOn] AS [CreatedOn]
     , [FinancialTransaction].[ocaslr_transactiondate] AS [TransactionDate]
     , [FinancialTransaction].[ocaslr_paymenttype] AS [PaymentType]
     , [FinancialTransaction].[ocaslr_paymentmethodid] AS [PaymentMethodId]
     , [FinancialTransaction].[ocaslr_transactiontype] AS [TransactionType]
     , [FinancialTransaction].[ocaslr_transactionamount] AS [TransactionAmount]
     , [FinancialTransaction].[ocaslr_returnedpaymentpaid] AS [ReturnedPaymentPaid]
     , [FinancialTransaction].[ocaslr_returnedpaymentchargepaid] AS [ReturnedPaymentChargePaid]
     , [FinancialTransaction].[ocaslr_payfromaccountbalance] AS [PayFromAccountBalance]
     , [FinancialTransaction].[ocaslr_paytoaccountbalance] AS [PayToAccountBalance]
     , [FinancialTransaction].[ocaslr_accountbalancebeforetransaction] AS [AccountBalanceBeforeTransaction]
     , [FinancialTransaction].[ocaslr_accountbalanceaftertransaction] AS [AccountBalanceAfterTransaction]
     , [FinancialTransaction].[ocaslr_overpaymentbalancebeforetransaction] AS [OverPaymentBalanceBeforeTransaction]
     , [FinancialTransaction].[ocaslr_overpaymentbalanceaftertransaction] AS [OverPaymentBalanceAfterTransaction]
     , [FinancialTransaction].[ocaslr_nsfbalancebeforetransaction] AS [NsfBalanceBeforeTransaction]
     , [FinancialTransaction].[ocaslr_nsfbalanceaftertransaction] AS [NsfBalanceAfterTransaction]
     , [FinancialTransaction].[ocaslr_returnedpaymentbeforetransaction] AS [ReturnedPaymentBeforeTransaction]
     , [FinancialTransaction].[ocaslr_returnedpaymentaftertransaction] AS [ReturnedPaymentAfterTransaction]
     , [FinancialTransaction].[ocaslr_returnedpaymentcharge] AS [ReturnedPaymentCharge]
     , [FinancialTransaction].[ocaslr_returnedpayment] AS [ReturnedPayment]
     , [FinancialTransaction].[ocaslr_payfromapplicationbalance] AS [PayFromApplicationBalance]
     , [FinancialTransaction].[ocaslr_paytoapplicationbalance] AS [PayToApplicationBalance]
     , [FinancialTransaction].[ocaslr_payfromoverpayment] AS [PayFromOverpayment]
     , [FinancialTransaction].[ocaslr_paytooverpayment] AS [PayToOverpayment]
     , [FinancialTransaction].[ocaslr_payfromtransfer] AS [PayFromTransfer]
     , [FinancialTransaction].[ocaslr_paytotransfer] AS [PayToTransfer]
     , [FinancialTransaction].[ocaslr_paymentamount] AS [PaymentAmount]
     , [FinancialTransaction].[ocaslr_orderamount] AS [OrderAmount]
     , [FinancialTransaction].[ocaslr_outstandingorderamount] AS [OutstandingOrderAmount]
     , [FinancialTransaction].[ocaslr_chequenumber] AS [ChequeNumber]
     , [FinancialTransaction].[ocaslr_returnchargeapplied] AS [ReturnChargeApplied]
     , [FinancialTransaction].[Ocaslr_note] AS [Note]
     , [FinancialTransaction].[ocaslr_moneyordernumber] AS [MoneyOrderNumber]
     , [FinancialTransaction].[ocaslr_applicantid] AS [ApplicantId]
     , [Contact].[FirstName] AS [ApplicantFirstName]
     , [Contact].[LastName] AS [ApplicantLastName]
     , [FinancialTransaction].[ocaslr_applicationid] AS [ApplicationId]
     , [TransactionApplication].[ocaslr_applicantid] AS [ApplicationApplicantId]
     , [ApplicationContact].[FirstName] AS [ApplicationFirstName]
     , [ApplicationContact].[LastName] AS [ApplicationLastName]
     , [FinancialTransaction].[ocaslr_orderid] AS [OrderId]
     , [FinancialTransaction].[ocaslr_orderitemid] AS [OrderDetailId]
     , [FinancialTransaction].[ocaslr_reffinancialtransactionid] AS [RelatedFinancialTransactionId]
     , [RelatedFinancialTransaction].[ocaslr_name] AS [RelatedFinancialTransactionName]
     , [RelatedOrder].[OrderNumber] AS [RelatedOrderNumber]
     , [Order].[OrderNumber] AS [OrderNumber]
     , [OrderApplication].[ocaslr_applicationId] AS [OrderApplicationId]
     , [OrderApplication].[ocaslr_applicationnumber] AS [OrderApplicationNumber]
     , [TransactionApplication].[ocaslr_applicationnumber] AS [TransactionApplicationNumber]
     , [FinancialTransaction].[ocaslr_paymenttransactiondetailid]    
FROM [$(SERVER)].[OCAS_MSCRM].[dbo].[ocaslr_financialtransactionBase] [FinancialTransaction]
    INNER JOIN [$(SERVER)].[OCAS_MSCRM].[dbo].[ContactBase] [Contact]
        ON [FinancialTransaction].[ocaslr_applicantid] = [Contact].[ContactId]
    LEFT OUTER JOIN [$(SERVER)].[OCAS_MSCRM].[dbo].[ocaslr_applicationBase] [TransactionApplication]
        ON [FinancialTransaction].[ocaslr_applicationid] = [TransactionApplication].[ocaslr_applicationId]
    LEFT OUTER JOIN [$(SERVER)].[OCAS_MSCRM].[dbo].[ContactBase] [ApplicationContact]
        ON [TransactionApplication].[ocaslr_applicantid] = [ApplicationContact].[ContactId]
    LEFT OUTER JOIN [$(SERVER)].[OCAS_MSCRM].[dbo].[SalesOrderBase] [Order]
        ON [FinancialTransaction].[ocaslr_orderid] = [Order].[SalesOrderId]
    LEFT OUTER JOIN [$(SERVER)].[OCAS_MSCRM].[dbo].[ocaslr_applicationBase] [OrderApplication]
        ON [Order].[ocaslr_applicationid] = [OrderApplication].[ocaslr_applicationId]
    LEFT OUTER JOIN [$(SERVER)].[OCAS_MSCRM].[dbo].[ocaslr_financialtransactionBase] [RelatedFinancialTransaction]
        ON [FinancialTransaction].[ocaslr_reffinancialtransactionid] = [RelatedFinancialTransaction].[ocaslr_financialtransactionId]
    LEFT OUTER JOIN [$(SERVER)].[OCAS_MSCRM].[dbo].[SalesOrderBase] [RelatedOrder]
        ON [RelatedFinancialTransaction].[ocaslr_orderid] = [RelatedOrder].[SalesOrderId]
WHERE [FinancialTransaction].[statecode] = 0 AND
      [FinancialTransaction].[statuscode] = 1
